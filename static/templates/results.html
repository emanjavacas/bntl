{% extends "template.html" %}

{% block title %}Results{% endblock %}

{% block content %}

{%- 
  set imgMap = {
    'ADVS': "cddvd",
    'BOOK': "boek",
    'CHAP': "artikelboek",
    'EJOUR': "artikelwebpage",
    'JFULL': "artikeltijdschrift",
    'JOUR': "tijdschriftofreeks",
    'WEB': "website"
} 
-%}

<div class="row">
    <div class="col">
        <h3 class="text-uppercase">ZOEKRESULTATEN</h3>
    </div>
<div class="row">
    <div class="col fw-light px-3 py-3 small">
        {{n_hits}} Zoekresultaten voor...
    </div>
</div>

<div class="row">
  <div class="col">
    <nav class="navbar navbar-light py-0" style="background-color: #e3f2fd;">
      <div class="container-fluid">
        <span class="navbar-text small">
          Sorteer op 
        <div class="btn-group px-2" role="group" aria-label="Basic outlined example">
          <a style="pointer-events: none;" class="btn btn-sm btn-outline-secondary">Auteur</a>
          <a class="btn btn-sm {% if sort_author == 'ascending' %}btn-secondary{% else %}btn-outline-secondary{% endif %}"
             href="{{source}}&sort_author={% if sort_author == 'ascending' %}{% else %}ascending{% endif %}&sort_year={{sort_year}}">
              <i class="bi bi-caret-up-fill"></i>
          </a>
          <a class="btn btn-sm {% if sort_author == 'descending' %}btn-secondary{% else %}btn-outline-secondary{% endif %}" 
            href="{{source}}&sort_author={% if sort_author == 'descending' %}{% else %}descending{% endif %}&sort_year={{sort_year}}">
            <i class="bi bi-caret-down-fill"></i>
          </a>
        </div>
        <div class="btn-group px-2" role="group" aria-label="Basic outlined example">
          <a style="pointer-events: none;" class="btn btn-sm btn-outline-secondary">Jaar</a>
          <a class="btn btn-sm {% if sort_year == 'ascending' %}btn-secondary{% else %}btn-outline-secondary{% endif %}"
             href="{{source}}&sort_year={% if sort_year == 'ascending' %}{% else %}ascending{% endif %}&sort_author={{sort_author}}">
              <i class="bi bi-caret-up-fill"></i>
          </a>
          <a class="btn btn-sm {% if sort_year == 'descending' %}btn-secondary{% else %}btn-outline-secondary{% endif %}" 
            href="{{source}}&sort_year={% if sort_year == 'descending' %}{% else %}descending{% endif %}&sort_author={{sort_author}}">
            <i class="bi bi-caret-down-fill"></i>
          </a>
        </div>
        </span>
        <span class="navbar-text small justify-content-end">Zoekresultaten per pagina
          <div class="btn-group px-2" role="group" aria-label="Basic outlined example">
            {% for targetSize in [10, 20, 50, 100] %}
              <a class="btn btn-sm btn-outline-secondary text-muted {% if size == targetSize %}disabled{% endif %}" role="button"
                href="{{source}}&sort_year={{sort_year}}&sort_author={{sort_author}}&size={{targetSize}}&page={{1 + (((page - 1) * size) // targetSize)}}">
                {{targetSize}}
              </a>
            {% endfor %}
          </div>
        </span>
      </div>
    </nav>
  </div>
</div>

<div class="row">
  <div class="col">
    <div class="accordion accordion-flush" id="searchItems">
      {% for item in items %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="flush-heading-{{loop.index}}">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse-{{loop.index}}" aria-expanded="false" aria-controls="flush-collapse-{{loop.index}}">
            <span class="pe-2">{{loop.index + (page - 1) * size}}.</span>
            <span class="px-2" data-bs-toggle="tooltip" data-bs-placement="top" title="{{item.type_of_reference}}">
              <img src="/static/assets/img/{{imgMap[item.type_of_reference]}}.png">
            </span>
            <span class="text-muted small pe-2">
              {% if item.unknown_tag and "AV" in item.unknown_tag %}
                {{item.unknown_tag["AV"][0]}}
              {% else %}
                {{item.title}}
              {% endif %}
            </span>
          </button>
        </h2>
        <div id="flush-collapse-{{loop.index}}" class="accordion-collapse collapse" aria-labelledby="flush-heading-{{loop.index}}" data-bs-parent="#searchItems">
          <div class="accordion-body">
            {% include "record.html" %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<div class="row">
  <div class="col">
    <nav class="navbar navbar-light py-0" style="background-color: #e3f2fd;">
      <div class="container justify-content-center">
        <span class="navbar-text">
          <ul class="pagination">
            <li class="page-item {% if page == 1 %}disabled{% endif %}">
              <a class="page-link" href="{{source}}&sort_year={{sort_year}}&sort_author={{sort_author}}&size={{size}}&page=1">&lt;&lt;</a>
            </li>
            <li class="page-item {% if page == 1 %}disabled{% endif %}">
              <a class="page-link" href="{{source}}&sort_year={{sort_year}}&sort_author={{sort_author}}&size={{size}}&page={{page-1}}">&lt;</a>
            </li>
            {% for i in range(from_page, to_page + 1) %}
              {% if i == page %}
                <li class="page-item disabled"><a class="page-link" href="#">{{i}}</a></li>
              {% else %}
                <li class="page-item"><a class="page-link" href="{{source}}&sort_year={{sort_year}}&sort_author={{sort_author}}&size={{size}}&page={{i}}">{{i}}</a></li>
              {% endif %}
            {% endfor %}
            <li class="page-item {% if page == total_pages or total_pages == 0 %}disabled{% endif %}">
              <a class="page-link" href="{{source}}&sort_year={{sort_year}}&sort_author={{sort_author}}&size={{size}}&page={{page+1}}">&gt;</a>
            </li>
            <li class="page-item {% if page == total_pages or total_pages == 0 %}disabled{% endif %}">
              <a class="page-link" href="{{source}}&sort_year={{sort_year}}&sort_author={{sort_author}}&size={{size}}&page={{total_pages}}">&gt;&gt;</a>
            </li>
          </ul>
        </span>
      </div>
    </nav>
  </div>
</div>

{% endblock %}